openapi: 3.0.3
info:
  title: Peanut Suite REST API
  description: |
    Complete REST API documentation for Peanut Suite WordPress plugin.

    ## Authentication

    The API supports two authentication methods:

    ### 1. WordPress Nonce (Cookie Auth)
    For browser-based requests, include the `X-WP-Nonce` header with a valid WordPress REST nonce.

    ### 2. API Key (Bearer Token)
    For programmatic access, use Bearer token authentication:
    ```
    Authorization: Bearer psk_your_api_key_here
    ```

    API keys can be scoped to specific resources:
    - `links:read`, `links:write`
    - `utms:read`, `utms:write`
    - `contacts:read`, `contacts:write`
    - `analytics:read`

    ## Rate Limiting

    - Login attempts: 5 per 5 minutes
    - Team invites: 10 per hour
    - General API: 60 requests per minute

    Rate limit headers are included in responses:
    - `X-RateLimit-Limit`
    - `X-RateLimit-Remaining`
    - `X-RateLimit-Reset`

  version: 4.2.38
  contact:
    name: Peanut Suite Support
    url: https://peanutgraphic.com
  license:
    name: Proprietary

servers:
  - url: /wp-json/peanut/v1
    description: WordPress REST API

tags:
  - name: Auth
    description: Authentication endpoints
  - name: UTMs
    description: UTM campaign tracking
  - name: Links
    description: Short link management
  - name: Contacts
    description: Contact/lead management
  - name: Popups
    description: Popup campaign management
  - name: Dashboard
    description: Dashboard statistics
  - name: Settings
    description: Plugin settings and configuration
  - name: Analytics
    description: Website analytics
  - name: Attribution
    description: Marketing attribution
  - name: Visitors
    description: Visitor tracking
  - name: Webhooks
    description: Incoming webhook management
  - name: Monitor
    description: Site monitoring (Agency)
  - name: Servers
    description: Plesk server monitoring
  - name: Accounts
    description: Multi-tenancy accounts
  - name: API Keys
    description: API key management
  - name: Health Reports
    description: Automated health reports

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: API Key authentication
    nonceAuth:
      type: apiKey
      in: header
      name: X-WP-Nonce
      description: WordPress REST nonce

  schemas:
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        data:
          type: object
          properties:
            status:
              type: integer

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
        total_pages:
          type: integer

    UTM:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        url:
          type: string
        utm_source:
          type: string
        utm_medium:
          type: string
        utm_campaign:
          type: string
        utm_term:
          type: string
          nullable: true
        utm_content:
          type: string
          nullable: true
        program:
          type: string
          nullable: true
        full_url:
          type: string
        clicks:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Link:
      type: object
      properties:
        id:
          type: integer
        slug:
          type: string
        destination_url:
          type: string
        title:
          type: string
        short_url:
          type: string
        clicks:
          type: integer
        is_active:
          type: boolean
        utm_id:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    Contact:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        first_name:
          type: string
        last_name:
          type: string
        phone:
          type: string
          nullable: true
        company:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, inactive, unsubscribed]
        source:
          type: string
        tags:
          type: array
          items:
            type: string
        custom_fields:
          type: object
        created_at:
          type: string
          format: date-time

    Popup:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        type:
          type: string
          enum: [modal, slide-in, bar, fullscreen]
        position:
          type: string
        status:
          type: string
          enum: [draft, active, paused, archived]
        title:
          type: string
        content:
          type: string
        views:
          type: integer
        conversions:
          type: integer
        triggers:
          type: object
        display_rules:
          type: object
        styles:
          type: object
        settings:
          type: object
        created_at:
          type: string
          format: date-time

    Visitor:
      type: object
      properties:
        id:
          type: integer
        visitor_id:
          type: string
        email:
          type: string
          nullable: true
        first_seen:
          type: string
          format: date-time
        last_seen:
          type: string
          format: date-time
        page_views:
          type: integer
        sessions:
          type: integer
        utm_source:
          type: string
          nullable: true
        utm_medium:
          type: string
          nullable: true
        utm_campaign:
          type: string
          nullable: true

    Webhook:
      type: object
      properties:
        id:
          type: integer
        source:
          type: string
        event:
          type: string
        payload:
          type: object
        status:
          type: string
          enum: [pending, processed, failed]
        processed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time

    MonitorSite:
      type: object
      properties:
        id:
          type: integer
        site_url:
          type: string
        site_name:
          type: string
        status:
          type: string
          enum: [active, disconnected, error]
        last_check:
          type: string
          format: date-time
          nullable: true
        last_health:
          type: object
        peanut_suite_active:
          type: boolean
        peanut_suite_version:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    PleskServer:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        host:
          type: string
        status:
          type: string
          enum: [active, disconnected, error]
        last_check:
          type: string
          format: date-time
          nullable: true
        cpu_usage:
          type: number
        memory_usage:
          type: number
        disk_usage:
          type: number
        domains_count:
          type: integer
        created_at:
          type: string
          format: date-time

    Account:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        slug:
          type: string
        tier:
          type: string
          enum: [free, pro, agency]
        owner_id:
          type: integer
        settings:
          type: object
        created_at:
          type: string
          format: date-time

    AccountMember:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        account_id:
          type: integer
        role:
          type: string
          enum: [owner, admin, member, viewer]
        email:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
        permissions:
          type: object
          nullable: true
        joined_at:
          type: string
          format: date-time

    ApiKey:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        key_preview:
          type: string
          description: Masked key (e.g., "psk_****abc123")
        scopes:
          type: array
          items:
            type: string
        last_used_at:
          type: string
          format: date-time
          nullable: true
        last_used_ip:
          type: string
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        created_by:
          type: integer
        created_at:
          type: string
          format: date-time

    ApiKeyWithSecret:
      allOf:
        - $ref: '#/components/schemas/ApiKey'
        - type: object
          properties:
            key:
              type: string
              description: Full API key (only shown once on creation)

    AuditLogEntry:
      type: object
      properties:
        id:
          type: integer
        account_id:
          type: integer
        user_id:
          type: integer
        user_name:
          type: string
        action:
          type: string
        resource_type:
          type: string
        resource_id:
          type: string
          nullable: true
        details:
          type: object
        ip_address:
          type: string
        user_agent:
          type: string
        created_at:
          type: string
          format: date-time

    HealthReport:
      type: object
      properties:
        id:
          type: integer
        generated_at:
          type: string
          format: date-time
        sites_data:
          type: array
          items:
            type: object
        servers_data:
          type: array
          items:
            type: object
        recommendations:
          type: array
          items:
            type: object
        overall_status:
          type: string
          enum: [healthy, warning, critical]

paths:
  # ==================== AUTH ====================
  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      email:
                        type: string
                      avatar:
                        type: string
                  account:
                    $ref: '#/components/schemas/Account'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout current user
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  redirect_url:
                    type: string

  # ==================== UTMs ====================
  /utms:
    get:
      tags: [UTMs]
      summary: List all UTMs
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
        - name: search
          in: query
          schema:
            type: string
        - name: utm_source
          in: query
          schema:
            type: string
        - name: utm_medium
          in: query
          schema:
            type: string
        - name: utm_campaign
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of UTMs
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/UTM'

    post:
      tags: [UTMs]
      summary: Create a UTM
      security:
        - bearerAuth: []
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, url, utm_source, utm_medium, utm_campaign]
              properties:
                name:
                  type: string
                url:
                  type: string
                utm_source:
                  type: string
                utm_medium:
                  type: string
                utm_campaign:
                  type: string
                utm_term:
                  type: string
                utm_content:
                  type: string
      responses:
        '201':
          description: UTM created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  utm:
                    $ref: '#/components/schemas/UTM'

  /utms/{id}:
    get:
      tags: [UTMs]
      summary: Get a UTM by ID
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: UTM details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UTM'

    put:
      tags: [UTMs]
      summary: Update a UTM
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                url:
                  type: string
                utm_source:
                  type: string
                utm_medium:
                  type: string
                utm_campaign:
                  type: string
      responses:
        '200':
          description: UTM updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  utm:
                    $ref: '#/components/schemas/UTM'

    delete:
      tags: [UTMs]
      summary: Delete a UTM
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: UTM deleted

  /utms/bulk-delete:
    post:
      tags: [UTMs]
      summary: Bulk delete UTMs
      security:
        - bearerAuth: []
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: UTMs deleted

  /utms/export:
    get:
      tags: [UTMs]
      summary: Export UTMs as CSV
      security:
        - nonceAuth: []
      responses:
        '200':
          description: CSV file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  # ==================== LINKS ====================
  /links:
    get:
      tags: [Links]
      summary: List all links
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Paginated list of links
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Link'

    post:
      tags: [Links]
      summary: Create a link
      security:
        - bearerAuth: []
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [destination_url]
              properties:
                slug:
                  type: string
                destination_url:
                  type: string
                title:
                  type: string
                utm_id:
                  type: integer
      responses:
        '201':
          description: Link created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  link:
                    $ref: '#/components/schemas/Link'

  /links/{id}:
    get:
      tags: [Links]
      summary: Get a link by ID
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Link details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Link'

    put:
      tags: [Links]
      summary: Update a link
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Link updated

    delete:
      tags: [Links]
      summary: Delete a link
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Link deleted

  /links/{id}/clicks:
    get:
      tags: [Links]
      summary: Get link click analytics
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Click analytics

  /links/{id}/qr:
    get:
      tags: [Links]
      summary: Generate QR code for link
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: QR code URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  qr_url:
                    type: string

  /links/bulk-delete:
    post:
      tags: [Links]
      summary: Bulk delete links
      security:
        - bearerAuth: []
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: Links deleted

  # ==================== CONTACTS ====================
  /contacts:
    get:
      tags: [Contacts]
      summary: List all contacts
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
        - name: source
          in: query
          schema:
            type: string
        - name: tag
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of contacts
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Contact'

    post:
      tags: [Contacts]
      summary: Create a contact
      security:
        - bearerAuth: []
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
                first_name:
                  type: string
                last_name:
                  type: string
                phone:
                  type: string
                company:
                  type: string
                source:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Contact created

  /contacts/{id}:
    get:
      tags: [Contacts]
      summary: Get a contact by ID
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contact details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Contact'

    put:
      tags: [Contacts]
      summary: Update a contact
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contact updated

    delete:
      tags: [Contacts]
      summary: Delete a contact
      security:
        - bearerAuth: []
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contact deleted

  /contacts/{id}/activities:
    get:
      tags: [Contacts]
      summary: Get contact activities
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contact activities

    post:
      tags: [Contacts]
      summary: Add activity to contact
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                description:
                  type: string
      responses:
        '201':
          description: Activity added

  /contacts/bulk-delete:
    post:
      tags: [Contacts]
      summary: Bulk delete contacts
      security:
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: Contacts deleted

  /contacts/bulk-status:
    post:
      tags: [Contacts]
      summary: Bulk update contact status
      security:
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: integer
                status:
                  type: string
      responses:
        '200':
          description: Statuses updated

  # ==================== POPUPS ====================
  /popups:
    get:
      tags: [Popups]
      summary: List all popups
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Paginated list of popups
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Popup'

    post:
      tags: [Popups]
      summary: Create a popup
      security:
        - nonceAuth: []
      responses:
        '201':
          description: Popup created

  /popups/{id}:
    get:
      tags: [Popups]
      summary: Get a popup by ID
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Popup details

    put:
      tags: [Popups]
      summary: Update a popup
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Popup updated

    delete:
      tags: [Popups]
      summary: Delete a popup
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Popup deleted

  /popups/{id}/stats:
    get:
      tags: [Popups]
      summary: Get popup statistics
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Popup statistics

  /popups/{id}/duplicate:
    post:
      tags: [Popups]
      summary: Duplicate a popup
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Popup duplicated

  # ==================== ACCOUNTS ====================
  /accounts:
    get:
      tags: [Accounts]
      summary: List user's accounts
      security:
        - nonceAuth: []
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Account'

  /accounts/{id}:
    get:
      tags: [Accounts]
      summary: Get account details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'

    put:
      tags: [Accounts]
      summary: Update account
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Account updated

  /accounts/{id}/members:
    get:
      tags: [Accounts]
      summary: Get account members
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AccountMember'

    post:
      tags: [Accounts]
      summary: Add team member
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, role]
              properties:
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [admin, member, viewer]
      responses:
        '201':
          description: Member added

  /accounts/{accountId}/members/{userId}:
    put:
      tags: [Accounts]
      summary: Update member role/permissions
      security:
        - nonceAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [admin, member, viewer]
                permissions:
                  type: object
      responses:
        '200':
          description: Member updated

    delete:
      tags: [Accounts]
      summary: Remove team member
      security:
        - nonceAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Member removed

  /accounts/{id}/transfer-ownership:
    post:
      tags: [Accounts]
      summary: Transfer account ownership
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [new_owner_id]
              properties:
                new_owner_id:
                  type: integer
      responses:
        '200':
          description: Ownership transferred

  /accounts/{id}/api-keys:
    get:
      tags: [API Keys]
      summary: List API keys
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of API keys
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiKey'

    post:
      tags: [API Keys]
      summary: Create API key
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, scopes]
              properties:
                name:
                  type: string
                scopes:
                  type: array
                  items:
                    type: string
                    enum:
                      - links:read
                      - links:write
                      - utms:read
                      - utms:write
                      - contacts:read
                      - contacts:write
                      - analytics:read
                expires_in_days:
                  type: integer
                  nullable: true
      responses:
        '201':
          description: API key created (key shown only once)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyWithSecret'

  /accounts/{accountId}/api-keys/{keyId}:
    delete:
      tags: [API Keys]
      summary: Revoke API key
      security:
        - nonceAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
        - name: keyId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: API key revoked

  /accounts/{accountId}/api-keys/{keyId}/regenerate:
    post:
      tags: [API Keys]
      summary: Regenerate API key
      security:
        - nonceAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
        - name: keyId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: New API key generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyWithSecret'

  /accounts/{id}/audit-log:
    get:
      tags: [Accounts]
      summary: Get audit log
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
        - name: action
          in: query
          schema:
            type: string
        - name: resource_type
          in: query
          schema:
            type: string
        - name: user_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Audit log entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditLogEntry'
                  meta:
                    $ref: '#/components/schemas/Pagination'

  # ==================== SETTINGS ====================
  /settings:
    get:
      tags: [Settings]
      summary: Get plugin settings
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Plugin settings

    post:
      tags: [Settings]
      summary: Update plugin settings
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Settings updated

  /settings/export:
    get:
      tags: [Settings]
      summary: Export all settings
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Exported settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  filename:
                    type: string
                  data:
                    type: object

  /settings/import:
    post:
      tags: [Settings]
      summary: Import settings
      security:
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
      responses:
        '200':
          description: Settings imported

  /settings/clear-cache:
    post:
      tags: [Settings]
      summary: Clear all caches
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Cache cleared

  /settings/delete-all:
    delete:
      tags: [Settings]
      summary: Delete all plugin data
      security:
        - nonceAuth: []
      parameters:
        - name: confirm
          in: query
          required: true
          schema:
            type: string
            enum: [DELETE_ALL_DATA]
      responses:
        '200':
          description: All data deleted

  # ==================== DASHBOARD ====================
  /dashboard:
    get:
      tags: [Dashboard]
      summary: Get dashboard statistics
      security:
        - nonceAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d, year]
      responses:
        '200':
          description: Dashboard statistics

  /dashboard/timeline:
    get:
      tags: [Dashboard]
      summary: Get timeline data
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Timeline data

  /dashboard/activity:
    get:
      tags: [Dashboard]
      summary: Get recent activity
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Recent activity

  # ==================== ANALYTICS ====================
  /analytics/overview:
    get:
      tags: [Analytics]
      summary: Get analytics overview
      security:
        - nonceAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d, year]
      responses:
        '200':
          description: Analytics overview

  /analytics/realtime:
    get:
      tags: [Analytics]
      summary: Get realtime analytics
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Realtime data

  /analytics/sources:
    get:
      tags: [Analytics]
      summary: Get traffic sources
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Traffic sources

  /analytics/devices:
    get:
      tags: [Analytics]
      summary: Get device breakdown
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Device breakdown

  # ==================== VISITORS ====================
  /visitors:
    get:
      tags: [Visitors]
      summary: List visitors
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Paginated visitors

  /visitors/{id}:
    get:
      tags: [Visitors]
      summary: Get visitor details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Visitor details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Visitor'

    delete:
      tags: [Visitors]
      summary: Delete visitor
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Visitor deleted

  /visitors/{id}/events:
    get:
      tags: [Visitors]
      summary: Get visitor events
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Visitor events

  /visitors/stats:
    get:
      tags: [Visitors]
      summary: Get visitor statistics
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Visitor statistics

  # ==================== WEBHOOKS ====================
  /webhooks:
    get:
      tags: [Webhooks]
      summary: List webhooks
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Paginated webhooks

  /webhooks/{id}:
    get:
      tags: [Webhooks]
      summary: Get webhook details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Webhook details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Webhook'

  /webhooks/{id}/reprocess:
    post:
      tags: [Webhooks]
      summary: Reprocess a webhook
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Webhook reprocessed

  /webhooks/stats:
    get:
      tags: [Webhooks]
      summary: Get webhook statistics
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Webhook statistics

  # ==================== MONITOR ====================
  /monitor/sites:
    get:
      tags: [Monitor]
      summary: List monitored sites
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Paginated sites

    post:
      tags: [Monitor]
      summary: Add site to monitor
      security:
        - nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [site_url]
              properties:
                site_url:
                  type: string
                site_name:
                  type: string
                site_key:
                  type: string
      responses:
        '201':
          description: Site added

  /monitor/sites/{id}:
    get:
      tags: [Monitor]
      summary: Get site details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Site details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonitorSite'

    delete:
      tags: [Monitor]
      summary: Remove site from monitoring
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Site removed

  /monitor/sites/{id}/check:
    post:
      tags: [Monitor]
      summary: Trigger health check
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Health check triggered

  /monitor/sites/{id}/health:
    get:
      tags: [Monitor]
      summary: Get site health details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Site health

  # ==================== SERVERS ====================
  /monitor/servers:
    get:
      tags: [Servers]
      summary: List Plesk servers
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Paginated servers

    post:
      tags: [Servers]
      summary: Add Plesk server
      security:
        - nonceAuth: []
      responses:
        '201':
          description: Server added

  /monitor/servers/{id}:
    get:
      tags: [Servers]
      summary: Get server details
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Server details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PleskServer'

    put:
      tags: [Servers]
      summary: Update server
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Server updated

    delete:
      tags: [Servers]
      summary: Remove server
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Server removed

  /monitor/servers/{id}/check:
    post:
      tags: [Servers]
      summary: Force health check
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Health check triggered

  /monitor/servers/{id}/health:
    get:
      tags: [Servers]
      summary: Get health history
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Health history

  /monitor/servers/{id}/domains:
    get:
      tags: [Servers]
      summary: Get server domains
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Server domains

  /monitor/servers/{id}/services:
    get:
      tags: [Servers]
      summary: Get server services
      security:
        - nonceAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Server services

  # ==================== HEALTH REPORTS ====================
  /health-reports/settings:
    get:
      tags: [Health Reports]
      summary: Get report settings
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Report settings

    post:
      tags: [Health Reports]
      summary: Update report settings
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Settings updated

  /health-reports/latest:
    get:
      tags: [Health Reports]
      summary: Get latest report
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Latest health report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthReport'

  /health-reports/history:
    get:
      tags: [Health Reports]
      summary: Get report history
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Report history

  /health-reports/preview:
    get:
      tags: [Health Reports]
      summary: Preview current health report
      security:
        - nonceAuth: []
      responses:
        '200':
          description: Report preview

  /health-reports/generate:
    post:
      tags: [Health Reports]
      summary: Generate new report
      security:
        - nonceAuth: []
      responses:
        '201':
          description: Report generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthReport'

  /health-reports/send:
    post:
      tags: [Health Reports]
      summary: Send report immediately
      security:
        - nonceAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                report_id:
                  type: integer
      responses:
        '200':
          description: Report sent
